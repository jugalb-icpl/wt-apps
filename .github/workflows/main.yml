name: Docker Image CI

on:
  push:
    branches: [ "master" ]

env:
  DOCKER_USERNAME: jugalb
  DOCKER_REPO: wt-apps
  DOCKER_IMG_CLIENT: client
  DOCKER_IMG_SERVER: server

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Log in to Docker Hub
      env:
        DOCKER_PASSWORD: ${{ secrets.DOCKERPW }}
      run: docker login -u "${{ env.DOCKER_USERNAME }}" -p ${DOCKER_PASSWORD}

    - name: Build and push server Docker image
      working-directory: ./server
      run: |
        docker build -t jugalb/${{ env.DOCKER_REPO }}:${{ env.DOCKER_IMG_SERVER }}
        docker push jugalb/${{ env.DOCKER_REPO }}:${{ env.DOCKER_IMG_SERVER }}

    - name: Build and push client Docker image
      working-directory: ./client
      run: |
        docker build -t jugalb/${{ env.DOCKER_REPO }}:${{ env.DOCKER_IMG_CLIENT }}
        docker push jugalb/${{ env.DOCKER_REPO }}:${{ env.DOCKER_IMG_CLIENT }}
